# Homura å¼€å‘æŒ‡å—

> ğŸ”¥ Next-Gen AI Browser Automation Agent

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
homura/
â”œâ”€â”€ docs/                        # å¼€å‘æ–‡æ¡£
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ icons/                  # æ‰©å±•å›¾æ ‡
â”‚   â””â”€â”€ test-pages/             # æµ‹è¯•é¡µé¢
â”‚       â””â”€â”€ audit-table.html
â”‚
â””â”€â”€ src/
    â”œâ”€â”€ background/             # Service Workerï¼ˆæ™ºèƒ½å±‚ï¼‰
    â”‚   â”œâ”€â”€ index.ts           # å…¥å£ + æ¶ˆæ¯è·¯ç”± + AI åˆå§‹åŒ–
    â”‚   â””â”€â”€ orchestrator.ts    # ä»»åŠ¡ç¼–æ’é€»è¾‘
    â”‚
    â”œâ”€â”€ content/               # Content Scriptï¼ˆæ‰§è¡Œå±‚ï¼‰
    â”‚   â”œâ”€â”€ index.tsx          # å…¥å£
    â”‚   â”œâ”€â”€ messageHandler.ts  # æ¶ˆæ¯å¤„ç†ï¼ˆæ£€æŸ¥/å½•åˆ¶/æ‰§è¡Œï¼‰
    â”‚   â””â”€â”€ engine/            # ğŸ”¥ æ ¸å¿ƒå¼•æ“
    â”‚       â”œâ”€â”€ executor.ts       # Atomic Tool æ‰§è¡Œå™¨
    â”‚       â”œâ”€â”€ primitives.ts     # åº•å±‚åŸºå…ƒ (CLICK/INPUT/...)
    â”‚       â””â”€â”€ highlighter.ts    # è°ƒè¯•é«˜äº®
    â”‚
    â”œâ”€â”€ sidepanel/             # å½•åˆ¶å™¨ UI (React + Framer Motion)
    â”‚   â”œâ”€â”€ App.tsx            # ä¸»åº”ç”¨ï¼ˆåŒæ¨¡å¼åˆ‡æ¢ï¼‰
    â”‚   â”œâ”€â”€ components/
    â”‚   â”‚   â”œâ”€â”€ Header.tsx         # å¤´éƒ¨ï¼ˆå« Dashboard å…¥å£ï¼‰
    â”‚   â”‚   â”œâ”€â”€ InspectMode.tsx    # å…ƒç´ æ£€æŸ¥æ¨¡å¼ï¼ˆä¸»ç¼–æ’å™¨ï¼‰
    â”‚   â”‚   â”œâ”€â”€ SmartStatus.tsx    # AI å†³ç­–é¢æ¿ï¼ˆå‘¼å¸åŠ¨ç”»ï¼‰
    â”‚   â”‚   â”œâ”€â”€ PathVisualizer.tsx # è·¯å¾„æ¨¡å¼ï¼ˆç¥–å…ˆé˜¶æ¢¯ï¼‰
    â”‚   â”‚   â”œâ”€â”€ StructureView.tsx  # ç»“æ„æ¨¡å¼ï¼ˆScope+Anchor+Targetï¼‰
    â”‚   â”‚   â”œâ”€â”€ RecordingPanel.tsx # æ“ä½œå½•åˆ¶æ¨¡å¼
    â”‚   â”‚   â””â”€â”€ LogViewer.tsx      # æ—¥å¿—æŸ¥çœ‹å™¨
    â”‚   â”œâ”€â”€ stores/
    â”‚   â”‚   â”œâ”€â”€ missionStore.ts    # ä»»åŠ¡çŠ¶æ€ï¼ˆæ—§ï¼‰
    â”‚   â”‚   â””â”€â”€ recordingStore.ts  # å½•åˆ¶çŠ¶æ€ + AI ç­–ç•¥çŠ¶æ€
    â”‚   â””â”€â”€ utils/
    â”‚       â””â”€â”€ ensureContentScript.ts # Content Script æ³¨å…¥å·¥å…·
    â”‚
    â”œâ”€â”€ dashboard/             # ç®¡ç†ä¸­å¿ƒ UI (React)
    â”‚   â”œâ”€â”€ App.tsx            # ä¸»å¸ƒå±€
    â”‚   â”œâ”€â”€ components/
    â”‚   â”‚   â”œâ”€â”€ ToolLibrary.tsx    # å·¥å…·åº“å¡ç‰‡åˆ—è¡¨
    â”‚   â”‚   â”œâ”€â”€ RuleBookEditor.tsx # Markdown è§„åˆ™ç¼–è¾‘å™¨
    â”‚   â”‚   â””â”€â”€ ExecutionLog.tsx   # æ‰§è¡Œæ—¥å¿—é¢æ¿
    â”‚   â””â”€â”€ stores/
    â”‚       â””â”€â”€ toolStore.ts       # å·¥å…·åº“çŠ¶æ€ï¼ˆæŒä¹…åŒ–ï¼‰
    â”‚
    â”œâ”€â”€ services/              # å¤–éƒ¨æœåŠ¡æ¨¡å—
    â”‚   â””â”€â”€ ai/                # AI æœåŠ¡
    â”‚       â”œâ”€â”€ index.ts          # ç»Ÿä¸€å¯¼å‡º
    â”‚       â”œâ”€â”€ client.ts         # é€šä¹‰ API å®¢æˆ·ç«¯ï¼ˆå« generateSmartSelectorï¼‰
    â”‚       â”œâ”€â”€ smartRouter.ts    # æ™ºèƒ½ç­–ç•¥è·¯ç”±ï¼ˆPath vs Structureï¼‰
    â”‚       â”œâ”€â”€ prompts.ts        # AI Prompt æ¨¡æ¿
    â”‚       â”œâ”€â”€ tools.ts          # AI Tool Schema å®šä¹‰
    â”‚       â””â”€â”€ types.ts          # å« SmartSelectorContext/Result
    â”‚
    â”œâ”€â”€ shared/                # å…±äº«æ¨¡å—
    â”‚   â”œâ”€â”€ types.ts           # æ ¸å¿ƒç±»å‹å®šä¹‰
    â”‚   â”œâ”€â”€ constants.ts       # å¸¸é‡
    â”‚   â”œâ”€â”€ utils.ts           # å·¥å…·å‡½æ•°
    â”‚   â””â”€â”€ selectorBuilder/   # é€‰æ‹©å™¨ç”Ÿæˆæ¨¡å—
    â”‚       â”œâ”€â”€ index.ts          # ç»Ÿä¸€å¯¼å‡º
    â”‚       â”œâ”€â”€ types.ts          # ç±»å‹ï¼ˆå« AncestorInfo, PathSelectorï¼‰
    â”‚       â”œâ”€â”€ analyzer.ts       # DOM åˆ†æï¼ˆå«è·¯å¾„æ”¶é›†ã€è¯­ä¹‰è¯„åˆ†ï¼‰
    â”‚       â”œâ”€â”€ generator.ts      # é€‰æ‹©å™¨ç”Ÿæˆ
    â”‚       â””â”€â”€ validator.ts      # é€‰æ‹©å™¨éªŒè¯
    â”‚
    â””â”€â”€ styles/
        â””â”€â”€ global.css         # å…¨å±€æ ·å¼
```

---

## ğŸ§ª å¦‚ä½•æµ‹è¯•

### 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm install
pnpm dev
```

### 2. åŠ è½½æ‰©å±•

1. æ‰“å¼€ `chrome://extensions/`
2. å¯ç”¨"å¼€å‘è€…æ¨¡å¼"
3. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº" â†’ é€‰æ‹© `dist` æ–‡ä»¶å¤¹

### 3. æµ‹è¯• SidePanelï¼ˆå½•åˆ¶å™¨ï¼‰

1. æ‰“å¼€ä»»æ„ç½‘é¡µï¼ˆé chrome:// é¡µé¢ï¼‰
2. **åˆ·æ–°é¡µé¢**ï¼ˆç¡®ä¿ Content Script åŠ è½½ï¼‰
3. ç‚¹å‡»æ‰©å±•å›¾æ ‡æ‰“å¼€ SidePanel
4. é€‰æ‹©æ¨¡å¼ï¼š
   - **æ£€æŸ¥**ï¼šç‚¹å‡»"å¼€å§‹æ£€æŸ¥"ï¼Œç„¶åç‚¹å‡»é¡µé¢å…ƒç´ 
     - SmartStatusï¼šæŸ¥çœ‹ AI å†³ç­–çŠ¶æ€å’Œç­–ç•¥
     - Tab åˆ‡æ¢ï¼šPathï¼ˆè·¯å¾„æ¨¡å¼ï¼‰/ Structureï¼ˆç»“æ„æ¨¡å¼ï¼‰
     - PathVisualizerï¼šäº¤äº’å¼ç¥–å…ˆé˜¶æ¢¯ï¼Œå‹¾é€‰åŒ…å«å±‚çº§
     - StructureViewï¼šScope+Anchor+Target é…ç½®
     - AI ä¼˜åŒ–ï¼šæ™ºèƒ½è·¯ç”±ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€ä½³ç­–ç•¥
   - **å½•åˆ¶**ï¼šç‚¹å‡»"å¼€å§‹å½•åˆ¶"ï¼Œåœ¨é¡µé¢ä¸Šæ“ä½œ

### 4. æµ‹è¯• Dashboardï¼ˆç®¡ç†ä¸­å¿ƒï¼‰

æ‰“å¼€æ–¹å¼ï¼š
- ç‚¹å‡» SidePanel å¤´éƒ¨çš„ Dashboard å›¾æ ‡
- å³é”®æ‰©å±•å›¾æ ‡ â†’ é€‰é¡¹
- ç›´æ¥è®¿é—® `chrome-extension://[ID]/src/dashboard/index.html`

### 5. æ·»åŠ æ–°æµ‹è¯•é¡µé¢

åœ¨ `public/test-pages/` ä¸­åˆ›å»ºæ–°çš„ HTML æ–‡ä»¶ï¼š

```
public/test-pages/
â”œâ”€â”€ audit-table.html      # å®¡æ‰¹è¡¨æ ¼æµ‹è¯•
â”œâ”€â”€ search-form.html      # æœç´¢è¡¨å•æµ‹è¯•ï¼ˆå¾…æ·»åŠ ï¼‰
â””â”€â”€ dynamic-list.html     # åŠ¨æ€åˆ—è¡¨æµ‹è¯•ï¼ˆå¾…æ·»åŠ ï¼‰
```

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### Scope + Anchor + Target æ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. SCOPE - æ‰¾åˆ°æ‰€æœ‰å®¹å™¨                                      â”‚
â”‚    "tr" â†’ [Row1, Row2, Row3, ...]                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. ANCHOR - åœ¨å®¹å™¨ä¸­å®šä½                                     â”‚
â”‚    ".name" contains "æå››" â†’ Row2                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. TARGET - åœ¨å®šä½çš„å®¹å™¨ä¸­æ“ä½œ                               â”‚
â”‚    ".btn-approve" â†’ CLICK                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```typescript
{
  scope: { type: 'container_list', selector: 'tr' },
  anchor: { type: 'text_match', selector: '.name', value: '{{student_name}}' },
  target: { selector: '.btn-approve', action: 'CLICK' }
}
```

### äº”å¤§åŸºå…ƒ (Primitives)

| åŸºå…ƒ | è¯´æ˜ | æ–‡ä»¶ä½ç½® |
|------|------|----------|
| `CLICK` | æ¨¡æ‹Ÿç‚¹å‡» | `primitives.ts` |
| `INPUT` | è¡¨å•è¾“å…¥ | `primitives.ts` |
| `EXTRACT_TEXT` | æå–æ–‡æœ¬ | `primitives.ts` |
| `WAIT_FOR` | ç­‰å¾…å…ƒç´  | `primitives.ts` |
| `NAVIGATE` | é¡µé¢å¯¼èˆª | `primitives.ts` |

### é€‰æ‹©å™¨ç”Ÿæˆæ¨¡å—

| æ¨¡å— | èŒè´£ |
|------|------|
| `analyzer.ts` | DOM åˆ†æï¼šå®¹å™¨è¯†åˆ«ã€é”šç‚¹å€™é€‰ã€è·¯å¾„æ”¶é›†ã€è¯­ä¹‰è¯„åˆ† |
| `generator.ts` | ç”Ÿæˆ Scope + Anchor + Target é€‰æ‹©å™¨é€»è¾‘ |
| `validator.ts` | å®æ—¶éªŒè¯é€‰æ‹©å™¨ã€è®¡ç®—åŒ¹é…æ•°é‡ |

### è·¯å¾„é€‰æ‹©å™¨

å¯¹äºå¤æ‚åµŒå¥—çš„å•ä¸€å…ƒç´ ï¼Œä½¿ç”¨è·¯å¾„é€‰æ‹©å™¨ä»£æ›¿ Scope+Anchor+Targetï¼š

```
ç›®æ ‡: input.input-inner
  â†“ å‘ä¸Šé€’å½’åˆ†æç¥–å…ˆ
div.official-header (score: 0.9) â† è¯­ä¹‰æ ¹
  â†“
div.section (score: 0.6) â† ä¿ç•™
  â†“
ç”Ÿæˆ: .official-header .section input.input-inner
```

æ ¸å¿ƒå‡½æ•°ï¼š
- `collectAncestorPath(element)`: æ”¶é›†ç¥–å…ˆè·¯å¾„ä¿¡æ¯
- `buildPathSelector(path, target)`: æ„å»ºè·¯å¾„é€‰æ‹©å™¨
- `calculateClassSemanticScore(class)`: è®¡ç®—ç±»åè¯­ä¹‰åˆ†æ•°

---

## ğŸ¨ UI è®¾è®¡ç†å¿µ

### å¿ƒæ™ºäº¤äº’ (Mindful Interaction)

æˆ‘ä»¬çš„è®¾è®¡å“²å­¦åŸºäº **"å¿ƒæ™ºäº¤äº’"** è¶‹åŠ¿ â€” ä»äº‰å¤ºæ³¨æ„åŠ›è½¬å‘**å°Šé‡æ³¨æ„åŠ›**ã€‚

#### ä¸‰å¤§åŸåˆ™

| åŸåˆ™ | å®è·µ |
|------|------|
| **æ•°å­—èŠ‚é£Ÿ** | å‡å°‘éå¿…è¦è§†è§‰å™ªéŸ³ï¼Œç•Œé¢èƒ½"æ·¡å‡º" |
| **æ¸è¿›å¼æŠ«éœ²** | é»˜è®¤åªæ˜¾ç¤ºæ ¸å¿ƒä¿¡æ¯ï¼Œéœ€è¦æ—¶å†å±•å¼€ |
| **ç©ºé—´é«˜æ•ˆ** | ä¾§è¾¹æ å¯¸åœŸå¯¸é‡‘ï¼Œæè‡´ç´§å‡‘å¸ƒå±€ |

#### è®¾è®¡è§„èŒƒ

```
è‰²å½©ï¼šDeep Space æš—è‰²ç³»
â”œâ”€â”€ èƒŒæ™¯ï¼šzinc-950ï¼ˆæ¥è¿‘çº¯é»‘ï¼‰
â”œâ”€â”€ å¡ç‰‡ï¼šzinc-900/50 + backdrop-blurï¼ˆæ¯›ç»ç’ƒï¼‰
â”œâ”€â”€ è¾¹æ¡†ï¼šwhite/5ï¼ˆææ·¡ï¼‰
â””â”€â”€ ç‚¹ç¼€ï¼šviolet-500 â†’ fuchsia-500ï¼ˆéœ“è™¹ç´«æ¸å˜ï¼‰

é€‰æ‹©å™¨é«˜äº®è‰²ï¼š
â”œâ”€â”€ Scope: blue-500ï¼ˆå®¹å™¨èŒƒå›´ï¼‰
â”œâ”€â”€ Anchor: green-500ï¼ˆå®šä½é”šç‚¹ï¼‰
â””â”€â”€ Target: violet-500ï¼ˆæ“ä½œç›®æ ‡ï¼‰

æ’ç‰ˆï¼š
â”œâ”€â”€ æ­£æ–‡ï¼štext-[11px] ~ text-[13px]
â”œâ”€â”€ æ ‡ç­¾ï¼štext-[9px] ~ text-[10px]
â””â”€â”€ ä»£ç ï¼šJetBrains Mono / Geist Mono

äº¤äº’ï¼š
â”œâ”€â”€ åŠ¨æ•ˆï¼štransition-all duration-200 ease-out
â”œâ”€â”€ è¾‰å…‰ï¼šshadow-neonï¼ˆhover æ—¶ï¼‰
â””â”€â”€ æ”¶æŠ˜ï¼šæ¸è¿›å¼æŠ«éœ²ï¼Œé»˜è®¤æ”¶èµ·å¡ç‰‡
```

---

## ğŸ“‹ å¼€å‘æ£€æŸ¥æ¸…å•

- [ ] æ–°åŠŸèƒ½æ˜¯å¦éµå¾ª Scope+Anchor+Target æ¨¡å¼ï¼Ÿ
- [ ] UI ç»„ä»¶æ˜¯å¦ä¿æŒç´§å‡‘ï¼ˆp-2/p-3ï¼Œtext-xsï¼‰ï¼Ÿ
- [ ] æ˜¯å¦å®ç°äº†æ¸è¿›å¼æŠ«éœ²ï¼ˆé»˜è®¤æ”¶èµ·ï¼‰ï¼Ÿ
- [ ] åŠ¨æ•ˆæ˜¯å¦èˆ’ç¼“ï¼ˆduration-200+ï¼‰ï¼Ÿ
- [ ] æ˜¯å¦æ·»åŠ äº†å¯¹åº”çš„æµ‹è¯•é¡µé¢ï¼Ÿ
- [ ] Content Script æ¶ˆæ¯å¤„ç†æ˜¯å¦æœ‰é”™è¯¯å¤„ç†ï¼Ÿ
- [ ] AI è°ƒç”¨æ˜¯å¦æœ‰é‡è¯•æœºåˆ¶ï¼Ÿ

---

## ğŸ”§ å¸¸è§é—®é¢˜

### "Could not establish connection" é”™è¯¯

**åŸå› **ï¼šContent Script æœªåŠ è½½

**è§£å†³**ï¼š
1. åˆ·æ–°ç›®æ ‡é¡µé¢
2. æ£€æŸ¥æ˜¯å¦åœ¨ chrome:// é¡µé¢ï¼ˆä¸æ”¯æŒï¼‰
3. é‡æ–°åŠ è½½æ‰©å±•

### Dashboard æ‰“ä¸å¼€

**è§£å†³**ï¼š
1. ç¡®è®¤æ‰©å±•å·²åŠ è½½
2. ä½¿ç”¨ SidePanel å¤´éƒ¨çš„ Dashboard æŒ‰é’®
3. æˆ–è®¿é—® `chrome-extension://[æ‰©å±•ID]/src/dashboard/index.html`

### é€‰æ‹©å™¨éªŒè¯å¤±è´¥

**æ£€æŸ¥**ï¼š
1. Scope é€‰æ‹©å™¨æ˜¯å¦åŒ¹é…åˆ°å…ƒç´ 
2. Anchor å€¼æ˜¯å¦ä¸é¡µé¢æ–‡æœ¬åŒ¹é…
3. Target é€‰æ‹©å™¨æ˜¯å¦åœ¨åŒ¹é…çš„ Scope å†…

---

## ğŸš€ è·¯çº¿å›¾

```
å·²å®Œæˆï¼š
â”œâ”€â”€ âœ… MVP: æ‰§è¡Œå¼•æ“ + Scope/Anchor/Target
â”œâ”€â”€ âœ… v0.2: SidePanel ä¸‰æ¨¡å¼
â”œâ”€â”€ âœ… v0.3: Dashboard å·¥å…·åº“ + è§„åˆ™ä¹¦
â”œâ”€â”€ âœ… v0.4: AI æœåŠ¡é›†æˆ
â”œâ”€â”€ âœ… v0.5: é€‰æ‹©å™¨ç”Ÿæˆæ¨¡å—
â””â”€â”€ âœ… v0.6: è·¯å¾„é€‰æ‹©å™¨ + AI Tool Calling

è¿›è¡Œä¸­ï¼š
â””â”€â”€ ğŸš§ v1.0: AI å®Œæ•´å·¥å…·ç”Ÿæˆ

è®¡åˆ’ä¸­ï¼š
â”œâ”€â”€ ğŸ“‹ v1.5: Rule Book è§£ææ‰§è¡Œ
â””â”€â”€ ğŸ“‹ v2.0: Self-Healing è‡ªåŠ¨ä¿®å¤
```

---

*Built with ğŸ”¥ å¿ƒæ™ºäº¤äº’è®¾è®¡å“²å­¦*
